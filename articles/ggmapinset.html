<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with 'ggmapinset' • ggmapinset</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with 'ggmapinset'">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggmapinset</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ggmapinset.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cidm-ph/ggmapinset/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with 'ggmapinset'</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cidm-ph/ggmapinset/blob/main/vignettes/ggmapinset.Rmd" class="external-link"><code>vignettes/ggmapinset.Rmd</code></a></small>
      <div class="d-none name"><code>ggmapinset.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cidm-ph/ggmapinset" class="external-link">ggmapinset</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sf</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This article provides some recipes for working with insets.</p>
<div class="section level2">
<h2 id="example-usage">Example usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<p>This example uses the mosquito surveillance dataset
<code><a href="../reference/mozzies_nsw2301.html">ggmapinset::mozzies_nsw2301</a></code>. It includes points from across
New South Wales.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mozzies_nsw2301</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   location week_ending species             count type     lat  long</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Albury   2023-01-07  Culex annulirostris low   inland -<span style="color: #BB0000;">36.1</span>  147.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Albury   2023-01-07  Aedes vigilax       <span style="color: #BB0000;">NA</span>    inland -<span style="color: #BB0000;">36.1</span>  147.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Albury   2023-01-07  total               low   inland -<span style="color: #BB0000;">36.1</span>  147.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Albury   2023-01-14  Culex annulirostris high  inland -<span style="color: #BB0000;">36.1</span>  147.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Albury   2023-01-14  Aedes vigilax       <span style="color: #BB0000;">NA</span>    inland -<span style="color: #BB0000;">36.1</span>  147.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Albury   2023-01-14  total               high  inland -<span style="color: #BB0000;">36.1</span>  147.</span></span></code></pre></div>
<p>Firstly, we can recreate the basic maps from the report accompanying
the dataset. Since the dataset has latitude and longitude coordinates,
it can easily be converted into a spatial data frame with
<code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># just take the total count from a single week of the data</span></span>
<span><span class="va">mozzies</span> <span class="op">&lt;-</span> <span class="va">mozzies_nsw2301</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"total"</span>, <span class="va">week_ending</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-07"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"WGS84"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low (&lt;50)"</span>, <span class="st">"Medium (50-100)"</span>, <span class="st">"High (101-1,000)"</span>,</span>
<span>            <span class="st">"Very High (1,001-10,000)"</span>, <span class="st">"Extreme (&gt;10,000)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scale1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"gold"</span>, <span class="st">"darkorange"</span>, <span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">labels</span>,</span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">scale2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_ordinal</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">labels</span>,</span>
<span>    range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    na.value <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mozzies</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">nswgeo</span><span class="fu">::</span><span class="va"><a href="https://cidm-ph.github.io/nswgeo/reference/nsw.html" class="external-link">nsw</a></span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">count</span>, colour <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">location</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span>, nudge_x <span class="op">=</span> <span class="fl">0.25</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">158</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale1</span> <span class="op">+</span> <span class="va">scale2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></span>
<span><span class="co">#&gt; give correct results for longitude/latitude data</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/unnamed-chunk-3-1.png" width="864"></p>
<p>The warning about <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_point_on_surface</a></code> can be
disregarded. Any errors due to the coordinate system are unlikely to
make much visual difference to where text is placed in this case.</p>
<p>This plot looks a little congested. We can improve things a bit by
using the repulsive version of the label geom from
<a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mozzies</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">nswgeo</span><span class="fu">::</span><span class="va"><a href="https://cidm-ph.github.io/nswgeo/reference/nsw.html" class="external-link">nsw</a></span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">count</span>, colour <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">location</span>, geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    point.padding <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"sf_coordinates"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">158</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale1</span> <span class="op">+</span> <span class="va">scale2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not</span></span>
<span><span class="co">#&gt; give correct results for longitude/latitude data</span></span>
<span><span class="co">#&gt; Warning: ggrepel: 7 unlabeled data points (too many overlaps). Consider</span></span>
<span><span class="co">#&gt; increasing max.overlaps</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>The main thing to note above is that <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel()</a></code>
is not hooked into the <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>’s geospatial integration,
so it needs to be told to use <code><a href="https://ggplot2.tidyverse.org/reference/stat_sf_coordinates.html" class="external-link">stat_sf_coordinates()</a></code> to
compute the coordinates, and it needs an explicit mapping for the
<code>geometry</code> aesthetic.</p>
<p>That improved most of the map except for the Sydney region where most
of the labels are missing since they would overlap. The
<code>max.overlaps</code> parameter to <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel()</a></code>
can help, but doesn’t address the overcrowding issue. This is where an
inset can help.</p>
<p>First we define the inset we want. We can collect up all the points
from the dataset that were labelled with <code>type == "sydney"</code>
and use some standard geospatial functions to get the diameter and
centre of a circle that will cover all those points. We then specify
that we want this circle to be enlarged by a factor of 4, and shifted to
south and east:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sydney</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mozzies</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"sydney"</span><span class="op">)</span></span>
<span><span class="va">sydney_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance</a></span><span class="op">(</span><span class="va">sydney</span>, <span class="va">sydney</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="st">"km"</span><span class="op">)</span></span>
<span><span class="va">sydney_centre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">sydney</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sydney_inset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_inset.html">configure_inset</a></span><span class="op">(</span></span>
<span>  centre <span class="op">=</span> <span class="va">sydney_centre</span>,</span>
<span>  radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sydney_size</span><span class="op">)</span>,</span>
<span>  translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="op">-</span><span class="fl">200</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"km"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can repeat the previous plot with the <code>_inset</code>
version of the relevant layers. The inset configuration is passed to the
coord. The only other change is that to make sure the labels for Sydney
sites appear in the inset instead of the base map, we need to remap the
<code>x</code> and <code>y</code> aesthetics to the versions computed by
the underlying stat.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mozzies</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">nswgeo</span><span class="fu">::</span><span class="va"><a href="https://cidm-ph.github.io/nswgeo/reference/nsw.html" class="external-link">nsw</a></span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">count</span>, colour <span class="op">=</span> <span class="va">count</span><span class="op">)</span>, map_base <span class="op">=</span> <span class="st">"clip"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">x_inset</span><span class="op">)</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">y_inset</span><span class="op">)</span>,</span>
<span>      label <span class="op">=</span> <span class="va">location</span>,</span>
<span>      geometry <span class="op">=</span> <span class="va">geometry</span></span>
<span>    <span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    force_pull <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    max.overlaps <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    point.padding <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"sf_coordinates_inset"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_inset_frame.html">geom_inset_frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/coord_sf_inset.html">coord_sf_inset</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">158</span><span class="op">)</span>, inset <span class="op">=</span> <span class="va">sydney_inset</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale1</span> <span class="op">+</span> <span class="va">scale2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/unnamed-chunk-6-1.png" width="960"></p>
<p>Further tweaks of label placement can be achieved by playing around
with the parameters of <code><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html" class="external-link">geom_text_repel()</a></code>, or by passing
vectors of positions into the <code>nudge_x</code> and
<code>nudge_y</code> parameters.</p>
</div>
<div class="section level2">
<h2 id="different-aesthetics-for-inset-layer">Different aesthetics for inset layer<a class="anchor" aria-label="anchor" href="#different-aesthetics-for-inset-layer"></a>
</h2>
<p>By default, <code><a href="../reference/geom_sf_inset.html">geom_sf_inset()</a></code> creates two copies of the
map layer: one for the base map and the other for the inset map. The
inset is transformed and clipped, but uses the same underlying
aesthetics mapping and parameters.</p>
<p>If you want to have different aesthetics for the two layers, you’ll
need to turn off this copying with <code>map_base = "none"</code>. With
this parameter set and an <code>inset</code> parameter provided, only
the inset layer will be drawn. To draw only the base layer, you can use
<code>map_inset = "none"</code>, <code>inset = NULL</code>, or simply
use the normal <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># this is equivalent to the following line:</span></span>
<span>  <span class="co"># geom_sf_inset(fill = "white", map_inset = "none") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">AREA</span><span class="op">)</span>, map_base <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_inset_frame.html">geom_inset_frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/coord_sf_inset.html">coord_sf_inset</a></span><span class="op">(</span>inset <span class="op">=</span> <span class="fu"><a href="../reference/configure_inset.html">configure_inset</a></span><span class="op">(</span></span>
<span>    centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">[</span><span class="va">nc</span><span class="op">$</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Bladen"</span><span class="op">]</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">50</span>, units <span class="op">=</span> <span class="st">"mi"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/separate-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="inset-frame-backgrounds">Inset frame backgrounds<a class="anchor" aria-label="anchor" href="#inset-frame-backgrounds"></a>
</h2>
<p>By default, the inset frame is transparent, although often it makes
sense to add a solid background so that the inset is distinguishable
from any overlapping part of the base map. The aesthetics of the two
parts of the frame and the burst lines connecting them can be controlled
separately.</p>
<p>Note that when the background is filled, we need to specify the base
and inset maps in separate layers so that the frame can slip in between
them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">AREA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_inset_frame.html">geom_inset_frame</a></span><span class="op">(</span>target.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">AREA</span><span class="op">)</span>, map_base <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/coord_sf_inset.html">coord_sf_inset</a></span><span class="op">(</span>inset <span class="op">=</span> <span class="fu"><a href="../reference/configure_inset.html">configure_inset</a></span><span class="op">(</span></span>
<span>    centre <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">[</span><span class="va">nc</span><span class="op">$</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Yancey"</span><span class="op">]</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="op">-</span><span class="fl">120</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">50</span>, units <span class="op">=</span> <span class="st">"mi"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/frame_fill-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="multiple-insets">Multiple insets<a class="anchor" aria-label="anchor" href="#multiple-insets"></a>
</h2>
<p>For multiple insets, the appropriate inset configuration just needs
to be passed to each layer separately. It’s probably clearer to avoid
providing an inset to the coordinate system in this case.</p>
<p>Since the inset-aware layers will duplicate themselves for the base
and inset maps, you will probably want to disable that behaviour with
<code>map_base = "none"</code> to avoid having multiple identical copies
of the base map.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inset1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_inset.html">configure_inset</a></span><span class="op">(</span></span>
<span>  centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">[</span><span class="va">nc</span><span class="op">$</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Bladen"</span><span class="op">]</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span>, hwidth <span class="op">=</span> <span class="fl">50</span>, units <span class="op">=</span> <span class="st">"mi"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">inset2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configure_inset.html">configure_inset</a></span><span class="op">(</span></span>
<span>  centre <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">[</span><span class="va">nc</span><span class="op">$</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Orange"</span><span class="op">]</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  translation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">120</span><span class="op">)</span>, radius <span class="op">=</span> <span class="fl">30</span>, units <span class="op">=</span> <span class="st">"mi"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># base map</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># inset 1</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span>map_base <span class="op">=</span> <span class="st">"none"</span>, inset <span class="op">=</span> <span class="va">inset1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_inset_frame.html">geom_inset_frame</a></span><span class="op">(</span>inset <span class="op">=</span> <span class="va">inset1</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># inset 2</span></span>
<span>  <span class="fu"><a href="../reference/geom_sf_inset.html">geom_sf_inset</a></span><span class="op">(</span>map_base <span class="op">=</span> <span class="st">"none"</span>, inset <span class="op">=</span> <span class="va">inset2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_inset_frame.html">geom_inset_frame</a></span><span class="op">(</span>inset <span class="op">=</span> <span class="va">inset2</span>, colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggmapinset_files/figure-html/multiple-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carl Suster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
